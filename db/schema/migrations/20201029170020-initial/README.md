# Migration `20201029170020-initial`

This migration has been generated by Nalaka Manathunga at 10/29/2020, 6:00:20 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."Client" DROP CONSTRAINT "Client_userId_fkey"

ALTER TABLE "public"."AuthToken" DROP CONSTRAINT "AuthToken_clientId_fkey"

ALTER TABLE "public"."AuthToken" DROP COLUMN "clientId"

CREATE TABLE "public"."_OrgMemberToPermission" (
"A" integer   NOT NULL ,
"B" integer   NOT NULL 
)

CREATE UNIQUE INDEX "_OrgMemberToPermission_AB_unique" ON "public"."_OrgMemberToPermission"("A", "B")

CREATE INDEX "_OrgMemberToPermission_B_index" ON "public"."_OrgMemberToPermission"("B")

ALTER TABLE "public"."_OrgMemberToPermission" ADD FOREIGN KEY ("A")REFERENCES "public"."OrgMember"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_OrgMemberToPermission" ADD FOREIGN KEY ("B")REFERENCES "public"."Permission"("id") ON DELETE CASCADE ON UPDATE CASCADE

DROP TABLE "public"."Client"
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20201029170020-initial
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,81 @@
+generator client {
+  provider        = "prisma-client-js"
+  previewFeatures = ["connectOrCreate", "transactionApi"]
+}
+
+datasource db {
+  provider = "postgresql"
+  url = "***"
+}
+
+model User {
+  id              Int         @id @default(autoincrement())
+  createdAt       DateTime    @default(now())
+  updatedAt       DateTime    @updatedAt
+  status          UserStatus  @default(ACTIVE)
+  email           String      @unique
+  password        String
+  firstName       String?
+  lastName        String?
+  phoneNumber     String?
+  locale          String
+  emailVerifiedAt DateTime?
+  lastLogged      DateTime?
+  authTokens      AuthToken[]
+  orgMembers      OrgMember[]
+}
+
+model AuthToken {
+  id         String   @id @default(uuid())
+  createdAt  DateTime @default(now())
+  updatedAt  DateTime @updatedAt
+  revoked    Boolean  @default(false)
+  expiration DateTime
+  user       User     @relation(fields: [userId], references: [id])
+  userId     Int
+}
+
+model Permission {
+  id         Int         @id @default(autoincrement())
+  createdAt  DateTime    @default(now())
+  updatedAt  DateTime    @updatedAt
+  name       String?
+  code       String?
+  orgmembers OrgMember[]
+}
+
+model Organization {
+  id         Int         @id @default(autoincrement())
+  createdAt  DateTime    @default(now())
+  updatedAt  DateTime    @updatedAt
+  status     OrgStatus   @default(ACTIVE)
+  verifiedAt DateTime?
+  members    OrgMember[]
+}
+
+model OrgMember {
+  id             Int          @id @default(autoincrement())
+  joined         DateTime     @default(now())
+  updatedAt      DateTime     @updatedAt
+  memberType     MemberType
+  user           User         @relation(fields: [userId], references: [id])
+  userId         Int
+  organization   Organization @relation(fields: [organizationId], references: [id])
+  organizationId Int
+  permissions    Permission[]
+}
+
+enum MemberType {
+  BORD_MEMBER
+  ORG_MEMBER
+}
+
+enum UserStatus {
+  ACTIVE
+  INACTIVE
+}
+
+enum OrgStatus {
+  ACTIVE
+  INACTIVE
+}
```


